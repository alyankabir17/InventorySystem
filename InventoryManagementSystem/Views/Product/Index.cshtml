@using InventoryManagementSystem.Models.Entities
@using IMSClassLib

@model List<Product>

@{
    Layout = "~/Views/Shared/_DashLayout.cshtml";
    ViewData["Title"] = "Dashboard | Products";
}

<div class="container col-12 mt-5">
    <div class="d-flex bg-dark text-light align-items-center justify-content-between p-4 rounded-top">
        <h2 class="fw-bold mb-0">Products List</h2>

        <div>
            <a asp-controller="Dashboard" asp-action="Index" class="btn btn-outline-light me-2">
                &larr; Back to Dashboard
            </a>

            <a asp-action="Create" class="btn btn-primary">
                Add New Product
            </a>
        </div>
    </div>

    <table class="table table-striped table-bordered border-rounded">
        <thead class="bg-dark text-light fw-bold">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Quantity</th>
                <th>Stock Level</th>
                <th>Unit Price</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null)
            {
                @foreach (var product in Model)
                {
                    <tr>
                        <td>@product.Id</td>
                        <td>@product.Name</td>
                        <td>@product.Description</td>
                        <td>@product.Quantity</td>

                        @{
                            // Using your custom library to check stock
                            var inventory = new InventoryManager();
                            var status = inventory.CheckStockStatus(product.Quantity);
                        }

                        <td>
                            @if (status == 1)
                            {
                                <span class="badge bg-success">High</span>
                            }
                            else if (status == 0)
                            {
                                <span class="badge bg-warning">Medium</span>
                            }
                            else if (status == -1)
                            {
                                <span class="badge bg-danger">Low</span>
                            }
                        </td>
                        <td>@product.UnitPrice</td>
                        <td class="d-flex align-items-center justify-content-center gap-2">
                            <a asp-action="Edit" class="btn btn-primary btn-sm" asp-route-id="@product.Id">Edit</a>
                            <form method="post" asp-action="Delete" asp-route-id="@product.Id" onsubmit="return confirm('Are you sure you want to delete this product?');">
                                <button class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>